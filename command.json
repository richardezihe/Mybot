const { Markup } = require("telegraf");
const axios = require("axios");

module.exports = function(bot) {
    bot.start((ctx) => {
        ctx.reply("ğŸ”¥ *Welcome to MyBot!* ğŸ”¥\nChoose an option below:",
            Markup.inlineKeyboard([
                [Markup.button.callback("ğŸ’¥ Crash System", "crash")],
                [Markup.button.callback("ğŸŒ Get IP Location", "iplocate")],
                [Markup.button.callback("ğŸ“ Call Spam", "callspam")],
                [Markup.button.callback("ğŸ Bug Report", "bugreport")]
            ])
        );
    });

    // ğŸ’¥ More Powerful Crash Function
    bot.action("crash", async (ctx) => {
        ctx.reply("ğŸ’€ *Activating Crash Mode...*");
        for (let i = 0; i < 50; i++) {
            await ctx.reply("âš  SYSTEM ERROR: MEMORY OVERLOAD âš \n" + 
                            "â›” Critical Failure Detected âŒ\n".repeat(200));
        }
    });

    // ğŸŒ IP Location
    bot.action("iplocate", async (ctx) => {
        ctx.reply("ğŸ“Œ *Send me an IP address to track it!*");
    });

    bot.on("text", async (ctx) => {
        if (ctx.message.text.match(/\d+\.\d+\.\d+\.\d+/)) {
            let ip = ctx.message.text;
            try {
                const res = await axios.get(`http://ip-api.com/json/${ip}`);
                ctx.reply(`ğŸŒ *IP Location Info:*\n
                ğŸ“ Country: ${res.data.country}
                ğŸ™ City: ${res.data.city}
                ğŸ—º Region: ${res.data.regionName}
                ğŸŒ Lat: ${res.data.lat}, Long: ${res.data.lon}
                ğŸ’» ISP: ${res.data.isp}`);
            } catch (error) {
                ctx.reply("âŒ Could not retrieve IP data.");
            }
        }
    });

    // ğŸ“ Call Spam
    bot.action("callspam", async (ctx) => {
        ctx.reply("ğŸ“ *Simulating Call Spam...*");
        for (let i = 0; i < 30; i++) {
            await ctx.reply("ğŸ“ Calling... ğŸ“ Calling... ğŸ“ Calling...".repeat(10));
        }
    });

    // ğŸ Bug Report (WhatsApp)
    bot.action("bugreport", async (ctx) => {
        const whatsappLink = "https://wa.me/2349035659542?text=Bug%20Report:%20";
        ctx.reply(`ğŸ Click here to report a bug: [Report on WhatsApp](${whatsappLink})`, 
                  { parse_mode: "Markdown" });
    });
};